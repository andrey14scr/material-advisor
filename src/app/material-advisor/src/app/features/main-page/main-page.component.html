<mat-label *ngIf="ownedTopics && ownedTopics.length">Owned topics:</mat-label>

<mat-list *ngIf="ownedTopics && ownedTopics.length">
  <ng-container *ngFor="let topic of ownedTopics">
    <mat-list-item>
      <div class="d-flex align-items-center">
        <span [ngClass]="{'gray-text': isLoadingTopic(topic) }">{{ translateText(topic.name) }}</span>
        <span *ngIf="isLoadingTopic(topic)" class="gray-text ms-2">is loading...</span>
        <div *ngIf="isLoadingTopic(topic)" class="d-flex">
          <mat-progress-spinner [diameter]="18" mode="indeterminate"/>
        </div>
        <span *ngIf="!isLoadingTopic(topic)" class="ms-1">
          <button mat-icon-button (click)="navigateToTopicDetails(topic.id)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button (click)="deleteTopic(topic.id)">
            <mat-icon>delete</mat-icon>
          </button>
        </span>
      </div>
    </mat-list-item>
    <mat-list *ngIf="topic.knowledgeChecks.length" class="ms-4">
      <ng-container *ngFor="let knowledgeCheck of topic.knowledgeChecks">
        <mat-list-item>
          <div class="d-flex flex-row align-items-center">
            <span>{{ knowledgeCheck.name }}</span>
            <div class="ms-1">
              <button mat-icon-button [disabled]="!knowledgeCheck.attemptsToVerifyCount" (click)="openKnowledgeCheckVerifyPage(knowledgeCheck.id)">
                <mat-icon>library_books</mat-icon>
              </button>
              <span *ngIf="knowledgeCheck.attemptsToVerifyCount" class="rounded-pill bg-primary badge-count text-white">
                {{knowledgeCheck.dataCount}}
              </span>
              <button mat-icon-button (click)="downloadReport(knowledgeCheck)">
                <mat-icon>download</mat-icon>
              </button>
              <span *ngIf="knowledgeCheck.dataCount" class="rounded-pill bg-primary badge-count text-white">
                {{knowledgeCheck.dataCount}}
              </span>
              <button mat-icon-button (click)="openKnowledgeCheckDialog(topic, knowledgeCheck.id)">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button (click)="deleteKnowledgeCheck(topic, knowledgeCheck.id)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </mat-list-item>
      </ng-container>
    </mat-list>
  </ng-container>
</mat-list>

<hr *ngIf="ownedTopics && ownedTopics.length"/>

<mat-label *ngIf="topics && topics.length">Topics to pass:</mat-label>
<mat-label *ngIf="!topics || !topics.length">No topics to pass</mat-label>

<mat-list *ngIf="topics && topics.length">
  <ng-container *ngFor="let topic of topics">
    <mat-list *ngIf="topic.knowledgeChecks.length" class="ms-4">
      <ng-container *ngFor="let knowledgeCheck of topic.knowledgeChecks">
        <mat-list-item>
          <div class="d-flex flex-row">
            <div *ngIf="knowledgeCheck.usedAttempts > 0" 
                class="d-flex align-items-center justify-content-center me-1" 
                [class.text-success]="knowledgeCheck.isVerified" 
                [class.text-secondary]="!knowledgeCheck.isVerified" 
                [class.text-danger]="knowledgeCheck.isVerified && knowledgeCheck.score != null && knowledgeCheck.score < knowledgeCheck.passScore">
              <mat-icon *ngIf="knowledgeCheck.isSubmitted && knowledgeCheck.score == null || knowledgeCheck.isSubmitted && knowledgeCheck.score != null && knowledgeCheck.score >= knowledgeCheck.passScore">
                task_alt
              </mat-icon>
              <mat-icon *ngIf="!knowledgeCheck.isSubmitted" class="material-symbols-outlined">
                error
              </mat-icon>
              <mat-icon *ngIf="knowledgeCheck.isSubmitted && knowledgeCheck.score != null && knowledgeCheck.score < knowledgeCheck.passScore" 
                class="material-symbols-outlined">
                cancel
              </mat-icon>
            </div>
            <span *ngIf="!isActual(knowledgeCheck)" class="text-secondary">
              {{ knowledgeCheck.name }}. {{getDateLabel(knowledgeCheck)}}. {{getAttemptsLabel(knowledgeCheck)}}. ({{getTimeLabel(knowledgeCheck.time)}})
            </span>
            <span *ngIf="isActual(knowledgeCheck)" class="link-text" (click)="startKnowledgeCheck(topic, knowledgeCheck)">
              {{ knowledgeCheck.name }}. {{getDateLabel(knowledgeCheck)}}. {{getAttemptsLabel(knowledgeCheck)}}. ({{getTimeLabel(knowledgeCheck.time)}})
            </span>
            <span *ngIf="knowledgeCheck.isSubmitted && knowledgeCheck.isVerified && knowledgeCheck.score != null" 
                class="ms-2"
                [class.text-success]="knowledgeCheck.score >= knowledgeCheck.passScore"
                [class.text-danger]="knowledgeCheck.score < knowledgeCheck.passScore">
              Score: {{ knowledgeCheck.score }} / {{ knowledgeCheck.maxScore }} (Pass score: {{ knowledgeCheck.passScore }})
            </span>
          </div>
        </mat-list-item>
      </ng-container>
    </mat-list>
  </ng-container>
</mat-list>