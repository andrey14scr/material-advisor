<loader [isLoading]="isLoading || isSubmittingGeneration"/>

<mat-expansion-panel hideToggle [expanded]="true">
  <mat-expansion-panel-header>
    <mat-panel-title> 
      {{ t('topic.title') }}:
    </mat-panel-title>
  </mat-expansion-panel-header>

  <div *ngIf="!isLoading" class="topic-card p-1">
    <form [formGroup]="form" enctype="multipart/form-data">
      <texts-input [formData]="currentTopic.name" [form]="form" formName="name" [isOneRow]="true" />
  
      <div *ngIf="!currentTopic.id">
        <line-separator labelText="{{ t('topic.generate.instruction') }}"/>
  
        <div class="d-flex justify-content-center mb-3">
          <mat-button-toggle-group [(value)]="selectedMode" [disabled]="isSubmittingGeneration">
            <mat-button-toggle [value]="TopicCreationMode.Generate">
              {{ t('actions.generate') }}
            </mat-button-toggle>
            <mat-button-toggle [value]="TopicCreationMode.Create">
              {{ t('actions.create') }}
            </mat-button-toggle>
          </mat-button-toggle-group>
        </div>
      </div>
    
      <!-- Generation section -->
      <div *ngIf="!currentTopic.id && selectedMode == TopicCreationMode.Generate" class="mt-3">
        <div>
          <mat-checkbox formControlName="doesComplexityIncrease">
            {{ t('topic.doesComplexityIncrease') }}
          </mat-checkbox>
        </div>
        
        <mat-form-field appearance="outline" subscriptSizing="dynamic" class="mt-3">
          <mat-label>
            {{ t('topic.generate.defaultAnswersCount') }}
          </mat-label>
          <input matInput formControlName="defaultAnswersCount" type="number" placeholder="{{ t('topic.generate.defaultAnswersCountPlaceholder') }}">
        </mat-form-field>
  
        <div class="mt-3">
          <questions-template-input [form]="form" formName="questionsStructure"/>
        </div>
  
        <mat-form-field appearance="outline" subscriptSizing="dynamic" class="mt-3">
          <mat-label>
            {{ t('topic.generate.languages') }}
          </mat-label>
          <mat-select formControlName="languages" multiple>
            <mat-option *ngFor="let language of languages" [value]="language.languageId" [disabled]="isAdditioanlLanguageChosen(language.languageId)">
              {{ getLanguageName(language.code) }}
            </mat-option>
          </mat-select>
        </mat-form-field>
  
        <mat-form-field appearance="outline" subscriptSizing="dynamic" class="mt-3">
          <mat-label>
            {{ t('topic.generate.cultureContext') }}
          </mat-label>
          <input matInput formControlName="cultureContext" type="text" placeholder="{{ t('topic.generate.cultureContextPlaceholder') }}">
        </mat-form-field>
  
        <div class="mt-3">
          <file-input (change)="onFileChange($event)"/>
        </div>
      
        <div class="d-flex justify-content-center mt-2">
          <button mat-raised-button color="primary" type="submit" [disabled]="isSubmittingGeneration" (click)="onGenerateSubmit()">
            {{ t('actions.generate') }}
          </button>
        </div>
      </div>
  
      <!-- Creation section -->
      <div *ngIf="currentTopic.id || selectedMode === TopicCreationMode.Create">
        <div class="questions">
          <questions-input [formData]="currentTopic.questions" [form]="form" [questionsFormArray]="questionsFormArray"/>
        </div>
  
        <div class="d-flex justify-content-center mt-2">
          <button mat-raised-button color="primary" type="submit" (click)="onCreateSubmit()">
            {{ this.currentTopic.id ? t('actions.update') : t('actions.create') }}
          </button>
          <button *ngIf="currentTopic.id" mat-raised-button class="ms-2" color="warn" type="submit" (click)="onDeleteSubmit()">
            {{ t('actions.delete') }}
          </button>
        </div>
      </div>
    </form>
  </div>
  
</mat-expansion-panel>

<mat-expansion-panel *ngIf="currentTopic.id" hideToggle [expanded]="true" class="mt-2">
  <mat-expansion-panel-header>
    <mat-panel-title>
      {{ t('knowledgeCheck.title') }}:
    </mat-panel-title>
  </mat-expansion-panel-header>
  <knowledge-check-list [topicId]="currentTopic.id"/>
</mat-expansion-panel>