<loader [isLoading]="isLoading || isSubmittingGeneration"/>

<mat-expansion-panel hideToggle [expanded]="true">
  <mat-expansion-panel-header>
    <mat-panel-title> Topic: </mat-panel-title>
  </mat-expansion-panel-header>

  <div *ngIf="!isLoading" class="topic-card p-1">
    <form [formGroup]="form" enctype="multipart/form-data">
      <texts-input [formData]="currentTopic.name" [form]="form" formName="name" [isOneRow]="true" />
  
      <div *ngIf="!currentTopic.id">
        <line-separator labelText="You can generate topic using materials from file OR create by yourself"/>
  
        <div class="d-flex justify-content-center mb-3">
          <mat-button-toggle-group [(value)]="selectedMode" [disabled]="isSubmittingGeneration">
            <mat-button-toggle [value]="TopicCreationMode.Generate">
              Generate
            </mat-button-toggle>
            <mat-button-toggle [value]="TopicCreationMode.Create">
              Create
            </mat-button-toggle>
          </mat-button-toggle-group>
        </div>
      </div>
    
      <!-- Generation section -->
      <div *ngIf="!currentTopic.id && selectedMode == TopicCreationMode.Generate" class="mt-3">
        <div>
          <mat-checkbox formControlName="doesComplexityIncrease">
            With complexity increasing
          </mat-checkbox>
        </div>
        
        <mat-form-field appearance="outline" subscriptSizing="dynamic" class="mt-3">
          <mat-label>Default answers count</mat-label>
          <input matInput formControlName="defaultAnswersCount" type="number" placeholder="Max Questions Count">
        </mat-form-field>
  
        <div class="mt-3">
          <questions-template-input [form]="form" formName="questionsTemplates"/>
        </div>
  
        <mat-form-field appearance="outline" subscriptSizing="dynamic" class="mt-3">
          <mat-label>Additional languages</mat-label>
          <mat-select formControlName="languages" multiple>
            <mat-option *ngFor="let language of languages" [value]="language.languageId" [disabled]="isAdditioanlLanguageChosen(language.languageId)">
              {{ getLanguageName(language.code) }}
            </mat-option>
          </mat-select>
        </mat-form-field>
  
        <mat-form-field appearance="outline" subscriptSizing="dynamic" class="mt-3">
          <mat-label>Culture context</mat-label>
          <input matInput formControlName="cultureContext" type="text" placeholder="Culture context">
        </mat-form-field>
  
        <div class="mt-3">
          <file-input (change)="onFileChange($event)"/>
        </div>
      
        <div class="d-flex justify-content-center mt-2">
          <button mat-raised-button color="primary" type="submit" [disabled]="isSubmittingGeneration" (click)="onGenerateSubmit()">
            Generate
          </button>
        </div>
      </div>
  
      <!-- Creation section -->
      <div *ngIf="currentTopic.id || selectedMode === TopicCreationMode.Create">
        <div class="questions">
          <questions-input [formData]="currentTopic.questions" [form]="form" [questionsFormArray]="questionsFormArray"/>
        </div>
  
        <div class="d-flex justify-content-center mt-2">
          <button mat-raised-button color="primary" type="submit" (click)="onCreateSubmit()">
            {{ this.currentTopic.id ? 'Update' : 'Create' }}
          </button>
          <button *ngIf="currentTopic.id" mat-raised-button class="ms-2" color="warn" type="submit" (click)="onDeleteSubmit()">
            Delete
          </button>
        </div>
      </div>
    </form>
  </div>
  
</mat-expansion-panel>

<mat-expansion-panel hideToggle [expanded]="true" class="mt-2">
  <mat-expansion-panel-header>
    <mat-panel-title> Knowledge checks: </mat-panel-title>
  </mat-expansion-panel-header>
  <knowledge-check-list *ngIf="currentTopic.id" [topicId]="currentTopic.id"/>
</mat-expansion-panel>